<%# 店舗検索フォーム用パーシャル %>
<%# 複合検索機能を提供：テキスト検索 + タグ検索 + 位置情報検索 %>
<div class="mb-6" role="search" aria-label="店舗検索">
  <%= form_with url: onsens_path, method: :get, local: true,
                class: "space-y-4 p-4 border rounded-lg bg-gray-50",
                'aria-label': "店舗検索フォーム" do |f| %>
    <%# テキスト・タグ検索セクション %>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <%# 温泉名・説明文での検索 %>
      <div>
        <%= f.label :q, t('activerecord.attributes.onsen.name'),
                     class: "block text-sm font-bold mb-1" %>
        <%= f.text_field :q, value: params[:q],
                          class: "w-full border rounded px-3 py-2",
                          placeholder: "例：松江洋菓子店",
                          'aria-label': t('views.onsens.index.search') %>
        <p class="text-xs text-gray-600 mt-1">店舗名や説明文で検索できます</p>
      </div>
      <%# タグでの絞り込み検索 %>
      <div>
        <%= f.label :tags, t('activerecord.attributes.onsen.tags'),
                     class: "block text-sm font-bold mb-1" %>
        <%= f.text_field :tags, value: params[:tags],
                          class: "w-full border rounded px-3 py-2",
                          placeholder: "例：スイーツ",
                          'aria-label': t('activerecord.attributes.onsen.tags') %>
        <p class="text-xs text-gray-600 mt-1">カンマ区切りで複数指定可能</p>
      </div>
    </div>
    <%# 位置情報検索セクション %>
    <%= render 'location_search_form', f: f %>
    <div class="flex items-center space-x-6">
      <%# ペット同伴可否フィルター %>
      <div class="flex items-center space-x-2">
        <label for="pet" class="text-sm font-semibold text-gray-800">ペット同伴</label>
        <%= select_tag :pet,
      options_for_select([
        ['指定なし', ''],
        ['可', 'true' ],
        ['不可', 'false' ]
      ], params[:pet]),
      include_blank: false,
      class: "text-sm h-8 px-2 border-gray-300 rounded" %>
      </div>
      <%# スタイルフィルター %>
      <div class="flex items-center space-x-2">
        <label for="style" class="text-sm font-semibold text-gray-800">ジャンル</label>
        <%= select_tag :style,
      options_for_select([
        ['指定なし', ''],
        ['和', 'japanese'],
        ['洋', 'western']
      ], params[:style]),
      include_blank: false,
      class: "text-sm h-8 px-2 border-gray-300 rounded" %>
      </div>
    </div>
    <div class="flex items-center space-x-6">
      <%# 営業時間検索%>
      <label for="search_time" class="text-sm font-semibold text-gray-800">営業時間</label>
      <div class="text-sm">
        <% if params[:search_time].present? %>
          指定された時間: <%= params[:search_time] %>
        <% else %>
          指定なし
        <% end %>
      </div>
      <%= time_field_tag :search_time, id: "search_time" %>
      <%# 営業曜日検索%>
      <div class="flex items-center space-x-2">
        <label for="open_day" class="text-sm font-semibold text-gray-800">営業曜日</label>
        <%= select_tag :open_day,
      options_for_select([
        ['指定なし', ''],
        ['月', '月'],
        ['火', '火'],
        ['水', '水'],
        ['木', '木'],
        ['金', '金'],
        ['土', '土'],
        ['日', '日']
      ], params[:open_day]),
      include_blank: false, id: "open_day",
      class: "text-sm h-8 px-2 border-gray-300 rounded" %>
      </div>
      <button type="button" onclick="setCurrentTimeAndDay()" class=" text-sm bg-gray-300 text-gray-800 px-3 py-1 rounded hover:bg-gray-400 focus:ring-2 focus:ring-gray-500 focus:ring-offset-2">
        現在の時間と曜日を設定
      </button>
    </div>
    <script>
      function setCurrentTimeAndDay() {
        const now = new Date();
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const timeString = `${hours}:${minutes}`;

        const days = ['日', '月', '火', '水', '木', '金', '土'];
        const dayString = days[now.getDay()];

        document.getElementById('search_time').value = timeString;
        document.getElementById('open_day').value = dayString;
      }
    </script>
    <%# 検索実行ボタン %>
    <div class="text-center pt-2">
      <%= f.submit t('views.onsens.index.search'),
                   class: "bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",
                   'aria-label': t('views.onsens.index.search') %>
    </div>
  <% end %>
</div>
